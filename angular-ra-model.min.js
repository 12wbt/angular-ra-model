"use strict";angular.module("ra.model",["ra.model.services"]),angular.module("ra.model.services",[]).run(["$rootScope","raModel",function(a,b){a.model=function(a,c){var d=b(this,a,c);return this[a]=d,d}}]).factory("raModel",["$rootScope","$cacheFactory","$location","$q",function(a,b,c,d){function e(a){var b=a.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!==b.length||b[0]?b:[]}function f(b,f,h){function i(a){return this.is={},this.opts={},angular.extend(this,a)}var j,k;angular.isString(b)&&(h=f,f=b,b=a),i.prototype.init=function(a){angular.isFunction(this.beforeInit)&&this.beforeInit(a);var b=m.call(this,a);return angular.isFunction(this.afterInit)&&this.afterInit(b,a),this.is.inited=!0,b},i.prototype.data=function(){var a={},b=this;return angular.forEach(r.call(this),function(c){c in b&&(a[c]=b[c])}),a};var l=function(a){var b=[];return a?b.push(a):this.opts.cache.key!==!0?b.push(this.opts.cache.key):b.push(c.path()),b.push(f),b.join("|")};i.prototype.cache=function(a,b){g.put(l.call(this,b),a)},i.prototype.cached=function(a){return g.get(l.call(this,a))},i.prototype.flush=function(a){g.remove(l.call(this,a))},i.prototype.snapshot=function(){k=this.data()},i.prototype.reset=function(){angular.extend(this,k)},i.prototype.update=function(){var a=this,c=d.defer(),e=function(d){angular.isFunction(a.updateSuccess)&&a.updateSuccess(d),a.is.updating=!1,a.is.processing=!1,a.snapshot(),b.$broadcast(a.name+":updateComplete",d),b.$broadcast(a.name+":updateSuccess",d),c.resolve(d)},f=function(d){angular.isFunction(a.updateError)&&a.updateError(d),a.is.updating=!1,a.is.processing=!1,b.$broadcast(a.name+":updateComplete",d),b.$broadcast(a.name+":updateError",d),c.reject(d)};return this.$update.call(this.data(),e,f),this.is.updating=!0,this.is.processing=!0,c.promise},i.prototype.extend=function(a){var b=this,c=Object.keys(a);angular.forEach(c,function(c){var d=a[c];if(angular.isFunction(d))if("$super"===e(d)[0]){var f=angular.copy(d),g=b[c];d=function(){return function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(g.bind(b)),f.apply(b,a)}}(c),b[c]=d}else b[c]=d}.bind(this))};var m=function(a){var b;if(this.opts.cache){var c=this.cached();if(c)return o.call(this,c),!0}if(this.resource){var d,e=[];this.params&&(d=angular.isFunction(this.params)?this.params():this.params),e.push(angular.extend({},d,a),n.bind(this));var f=this.resource,g=this;this.resource_method&&(f=f[this.resource_method],g=this.resource),b=f.apply(g,e),this.$promise=b.$promise.then(o.bind(this),p.bind(this))}else this.get&&(b=this.get());return this.is.loading=!0,b},n=function(a,b){this.$headers=b,this.$headers.parse=function(a){return angular.fromJson(this(a))}},o=function(a){if(q.call(this,a),this.resource_set!==!1)if(angular.isArray(a)){var c=this.resource_attribute||"items";this[c]=a}else $.extend(this,a);return this.is.loaded=!0,this.is.loading=!1,angular.isFunction(this.success)&&this.success(a,this.$headers),this.snapshot(),this.opts.cache&&this.opts.cache.set!==!1&&this.cache(a),b.$broadcast(f+":success",a,this.$headers),b.$broadcast(f+":complete",a,this.$headers),a},p=function(a){return this.is.loaded=!0,this.is.loading=!1,angular.isFunction(this.error)&&this.error(a),b.$broadcast(f+":error",a),b.$broadcast(f+":complete",a),a},q=function(a){var b;if(b=angular.isArray(a)&&a.length>0?a[0]:a,angular.isObject(b)){var c=[];angular.forEach(Object.keys(b),function(a){"$"!==a.charAt(0)&&"_"!==a.charAt(0)&&c.push(a)}),j=c}},r=function(){return angular.isArray(j)&&j.length>0?j:angular.isArray(this.keys)&&this.keys.length>0?this.keys:[]};return new i(h)}var g=b("raModel");return f}]);