"use strict";angular.module("ra.model",["ra.model.services"]),angular.module("ra.model.services",[]).run(["$rootScope","raModel",function(a,b){a.model=function(a,c){var d=b(this,a,c);return this[a]=d,d}}]).factory("raModel",["$rootScope",function(a){function b(a){var b=a.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!==b.length||b[0]?b:[]}function c(c,d,e){function f(a){return this.is={},angular.extend(this,a)}var g,h;angular.isString(c)&&(e=d,d=c,c=a),f.prototype.init=function(a){return this.is.inited=!0,i.call(this,a)},f.prototype.data=function(){var a={},b=this;return angular.forEach(g,function(c){c in b&&(a[c]=b[c])}),a},f.prototype.snapshot=function(){h=this.data()},f.prototype.reset=function(){angular.extend(this,h)},f.prototype.update=function(){var a=this,b=this.data(),d=this.$update.call(b);return this.is.updating=!0,this.is.processing=!0,d.then(function(b){angular.isFunction(a.updateSuccess)&&a.updateSuccess(b),a.is.updating=!1,a.is.processing=!1,a.snapshot(),c.$broadcast(a.name+":updateComplete",b),c.$broadcast(a.name+":updateSuccess",b)}).catch(function(b){angular.isFunction(a.updateError)&&a.updateError(b),a.is.updating=!1,a.is.processing=!1,c.$broadcast(a.name+":updateComplete",b),c.$broadcast(a.name+":updateError",b)}),d},f.prototype.extend=function(a){var c=this,d=Object.keys(a);angular.forEach(d,function(d){var e=a[d];if(angular.isFunction(e))if("$super"===b(e)[0]){var f=angular.copy(e),g=c[d];e=function(){return function(){var a=Array.prototype.slice.call(arguments,0);a.push(g.bind(c)),f.apply(c,a)}}(d),c[d]=e}else c[d]=e}.bind(this))};var i=function(a){var b;if(this.resource){var c,d=[];this.params&&(c=angular.isFunction(this.params)?this.params():this.params),d.push(angular.extend({},c,a));var e=this.resource,f=this;this.resource_method&&(e=e[this.resource_method],f=this.resource),b=e.apply(f,d),b.$promise.then(j.bind(this),k.bind(this))}else this.get&&(b=this.get());return this.is.loading=!0,b},j=function(a){if(l.call(this,a),this.resource_set!==!1)if(angular.isArray(a)){var b=this.resource_attribute||"items";this[b]=a}else $.extend(this,a);this.is.loaded=!0,this.is.loading=!1,angular.isFunction(this.success)&&this.success(a),this.snapshot(),c.$broadcast(d+":success",a),c.$broadcast(d+":complete",a)},k=function(a){this.is.loaded=!0,this.is.loading=!1,angular.isFunction(this.error)&&this.error(a),c.$broadcast(d+":error",a),c.$broadcast(d+":complete",a)},l=function(a){var b;if(b=angular.isArray(a)&&a.length>1?a[0]:a,angular.isObject(b)){var c=[];angular.forEach(Object.keys(b),function(a){"$"!==a.charAt(0)&&"_"!==a.charAt(0)&&c.push(a)}),g=c}};return new f(e)}return c}]);